@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix rdfs:     <http://www.w3.org/2000/01/rdf-schema#> .
@prefix skos:     <http://www.w3.org/2004/02/skos/core#> .
@prefix sp:       <http://spinrdf.org/sp#> .

@prefix exercise: <http://mynarz.net/sparqlab/resource/exercise/> .
@prefix sparqlab: <http://mynarz.net/sparqlab/vocabulary#> .

###################
### SPIN labels ###
###################

sp:Aggregation skos:prefLabel "Agregace"@cs .
sp:AltPath skos:prefLabel "Alternativní cesta"@cs .
sp:Asc skos:prefLabel "ASC" .
sp:Ask skos:prefLabel "ASK" .
sp:Avg skos:prefLabel "AVG" .
sp:Bind skos:prefLabel "BIND" .
sp:Construct skos:prefLabel "CONSTRUCT" .
sp:Count skos:prefLabel "COUNT" .
sp:Desc skos:prefLabel "DESC" .
sp:Describe skos:prefLabel "DESCRIBE" .
sp:Exists skos:prefLabel "EXISTS" .
sp:Filter skos:prefLabel "FILTER" .
sp:GroupConcat skos:prefLabel "GROUP_CONCAT" .
sp:Max skos:prefLabel "MAX" .
sp:Min skos:prefLabel "MIN" .
sp:Minus skos:prefLabel "MINUS" .
sp:ModPath skos:prefLabel "Proměnná cesta"@cs .
sp:NamedGraph skos:prefLabel "GRAPH" .
sp:NotExists skos:prefLabel "NOT EXISTS" .
sp:Optional skos:prefLabel "OPTIONAL" .
sp:Path skos:prefLabel "Cesta" .
sp:ReversePath skos:prefLabel "Reverzní cesta"@cs .
sp:Sample skos:prefLabel "SAMPLE" .
sp:Select skos:prefLabel "SELECT" .
sp:SeqPath skos:prefLabel "Sekvence cest" .
sp:SubQuery skos:prefLabel "Vnořený dotaz" .
sp:Sum skos:prefLabel "SUM" .
sp:TriplePath skos:prefLabel "Cesta"@cs .
sp:Union skos:prefLabel "UNION" .
sp:Values skos:prefLabel "VALUES" .
sp:and skos:prefLabel "&&" .
sp:datatype skos:prefLabel "datatype" .
sp:distinct skos:prefLabel "DISTINCT" .
sp:eq skos:prefLabel "=" .
sp:from skos:prefLabel "FROM" .
sp:fromNamed skos:prefLabel "FROM NAMED" .
sp:groupBy skos:prefLabel "GROUP BY" .
sp:ge skos:prefLabel ">=" .
sp:gt skos:prefLabel ">" .
sp:having skos:prefLabel "HAVING" .
sp:iri skos:prefLabel "iri" .
sp:isLiteral skos:prefLabel "isLiteral" .
sp:lang skos:prefLabel "lang" .
sp:langMatches skos:prefLabel "langMatches" .
sp:limit skos:prefLabel "LIMIT" .
sp:le skos:prefLabel "<=" .
sp:lt skos:prefLabel "<" .
sp:ne skos:prefLabel "!=" .
sp:not skos:prefLabel "!" .
sp:notExists skos:prefLabel "NOT EXISTS" .
sp:offset skos:prefLabel "OFFSET" .
sp:orderBy skos:prefLabel "ORDER BY" .
sp:reduced skos:prefLabel "REDUCED" .
sp:regex skos:prefLabel "regex" .
sp:replace skos:prefLabel "replace" .
sp:sameTerm skos:prefLabel "sameTerm" .
sp:str skos:prefLabel "str" .
sp:strlen skos:prefLabel "strlen" .
sp:where skos:prefLabel "WHERE" .

#################
### Exercises ###
#################

exercise:classes a sp:Query ;
  rdfs:label "Instanciované třídy"@cs ;
  rdfs:comment "Vyberte třídy instanciované v datech (bez opakování)."@cs ;
  sp:text """
SELECT DISTINCT ?class
WHERE {
  [] a ?class .
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:classes-histogram a sp:Query ;
  rdfs:label "Četnost výskytů instanciovaných tříd"@cs ;
  rdfs:comment "Spočítejte četnost výskytů tříd instanciovaných v datech. Pro každou třídu uveďte počet jejích instancí a výsledky seřaďte sestupně dle počtu."@cs ;
  sp:text """
SELECT ?class (COUNT(?s) AS ?count)
WHERE {
  ?s a ?class .
}
GROUP BY ?class
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:classes-histogram-code-lists a sp:Query ;
  rdfs:label "Četnost výskytů tříd instanciovaných v číselnících"@cs ;
  rdfs:comment "Spočítejte četnost výskytů tříd instanciovaných v číselnících (pojmenovaný graf `https://data.cssz.cz/resource/dataset/pomocne-ciselniky`). Pro každou třídu uveďte počet jejích instancí a výsledky seřaďte sestupně dle počtu."@cs ;
  sp:text """
SELECT ?class (COUNT(?s) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?s a ?class .
  }
}
GROUP BY ?class
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:classes-histogram-data a sp:Query ;
  rdfs:label "Četnost výskytů tříd instanciovaných ve statistikách důchodů a důchodců"@cs ;
  rdfs:comment "Spočítejte četnost výskytů tříd instanciovaných ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Pro každou třídu uveďte počet jejích instancí a výsledky seřaďte sestupně dle počtu."@cs ;
  sp:text """
SELECT ?class (COUNT(?s) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    ?s a ?class .
  }
}
GROUP BY ?class
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:classes-histogram-metadata a sp:Query ;
  rdfs:label "Četnost výskytů tříd instanciovaných v metadatech"@cs ;
  rdfs:comment "Spočítejte četnost výskytů tříd instanciovaných v metadatech ke statistikám důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech/metadata`). Pro každou třídu uveďte počet jejích instancí a výsledky seřaďte sestupně dle počtu."@cs ;
  sp:text """
SELECT ?class (COUNT(?s) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech/metadata> {
    ?s a ?class .
  }
}
GROUP BY ?class
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:datatypes a sp:Query ;
  rdfs:label "Datové typy"@cs ;
  rdfs:comment "Pro každý datový typ literálů v datech uveďte počet literálů anotovaných tímto datovým typem. Výsledky seřaďte sestupně podle počtu literálů."@cs ;
  sp:text """
SELECT ?datatype (COUNT(*) AS ?count)
WHERE {
  [] ?p ?literal .
  FILTER (isLiteral(?literal) && datatype(?literal) != "")
  BIND (datatype(?literal) AS ?datatype)
}
GROUP BY ?datatype
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:named-graphs a sp:Query ;
  rdfs:label "Pojmenované grafy"@cs ;
  rdfs:comment "Vyberte pojmenované grafy v datech (bez opakování)."@cs ;
  sp:text """
SELECT DISTINCT ?graph
WHERE {
  GRAPH ?graph {
    [] ?p [] .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:object-property-path a sp:Query ;
  rdfs:label "Cesty mezi instancemi tříd"@cs ;
  rdfs:comment "Vyberte predikáty spojující instance tříd ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Pro každou kombinaci tříd a predikátu uveďte počet spojení a výsledky podle tohoto počtu seřaďte sestupně."@cs ;
  sp:text """
SELECT ?class1 ?p ?class2 (COUNT(*) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [ a ?class1 ] ?p [ a ?class2 ] .
  }
}
GROUP BY ?class1 ?p ?class2
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:one-quad a sp:Query ;
  rdfs:label "Jedna čtveřice"@cs ;
  rdfs:comment "Vyberte jednu (libovolnou) čtveřici z dat."@cs ;
  skos:note "Čtveřice je RDF trojice doplněná o identifikátor grafu, ve kterém se nachází."@cs ;
  sp:text """
SELECT *
WHERE {
  GRAPH ?g {
    ?s ?p ?o .
  }
}
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:one-triple a sp:Query ;
  rdfs:label "Jedna trojice"@cs ;
  rdfs:comment "Vyberte jednu (libovolnou) trojici z dat."@cs ;
  sp:text """
SELECT *
WHERE {
  ?s ?p ?o .
}
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:properties a sp:Query ;
  rdfs:label "Predikáty"@cs ;
  rdfs:comment "Vyberte predikáty použité v datech (bez opakování)."@cs ;
  sp:text """
SELECT DISTINCT ?property
WHERE {
  [] ?property [] .
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:properties-histogram a sp:Query ;
  rdfs:label "Četnost výskytů predikátů"@cs ;
  rdfs:comment "Spočítejte četnost výskytů predikátů použitých v datech. Pro každý predikát uveďte počet jeho použití a výsledky seřaďte sestupně podle tohoto počtu."@cs ;
  sp:text """
SELECT ?property (COUNT(*) AS ?count)
WHERE {
  [] ?property [] .
}
GROUP BY ?property
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:properties-histogram-code-lists a sp:Query ;
  rdfs:label "Četnost výskytů predikátů v číselnících"@cs ;
  rdfs:comment "Spočítejte četnost výskytů predikátů použitých v číselnících (pojmenovaný graf `https://data.cssz.cz/resource/dataset/pomocne-ciselniky`). Pro každý predikát uveďte počet jeho použití a výsledky seřaďte sestupně podle tohoto počtu."@cs ;
  sp:text """
SELECT ?property (COUNT(*) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    [] ?property [] .
  }
}
GROUP BY ?property
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:properties-histogram-data a sp:Query ;
  rdfs:label "Četnost výskytů predikátů ve statistikách důchodů a důchodců"@cs ;
  rdfs:comment "Spočítejte četnost výskytů predikátů použitých ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Pro každý predikát uveďte počet jeho použití a výsledky seřaďte sestupně podle tohoto počtu."@cs ;
  sp:text """
SELECT ?property (COUNT(*) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [] ?property [] .
  }
}
GROUP BY ?property
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:properties-histogram-metadata a sp:Query ;
  rdfs:label "Četnost výskytů predikátů v metadatech statistik důchodů a důchodců"@cs ;
  rdfs:comment "Spočítejte četnost výskytů predikátů použitých v metadatech ke statistikám důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech/metadata`). Pro každý predikát uveďte počet jeho použití a výsledky seřaďte sestupně podle tohoto počtu."@cs ;
  sp:text """
SELECT ?property (COUNT(*) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech/metadata> {
    [] ?property [] .
  }
}
GROUP BY ?property
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:properties-qb-observation-cardinality-data a sp:Query ;
  rdfs:label "Kardinality predikátů qb:Observation ve statistikách důchodů a důchodců"@cs ;
  rdfs:comment "Spočítejte minimální a maximální kardinality predikátů použitých pro popis instance `qb:Observation` ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Výsledky seřaďte sestupně podle maximální kardinality."@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>

SELECT ?p (MIN(?cardinality) AS ?minCardinality) (MAX(?cardinality) AS ?maxCardinality)
WHERE {
  {
    SELECT ?p (COUNT(?o) AS ?cardinality)
    WHERE {
      {
        SELECT DISTINCT ?p
        WHERE {
          GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
            [] a qb:Observation ;
              ?p [] .
          }
        }
      }
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        ?s a qb:Observation .
        OPTIONAL {
          ?s ?p ?o .
        }
      }
    }
    GROUP BY ?s ?p
  }
}
GROUP BY ?p
ORDER BY DESC(?maxCardinality)
  """ ;
  sparqlab:hasDifficulty sparqlab:hard .

exercise:properties-qb-observation-data a sp:Query ;
  rdfs:label "Predikáty pozorování ve statistikách důchodů a důchodců"@cs ;
  rdfs:comment "Vyberte predikáty pozorování (tj. instancí `qb:Observation`) ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Výsledky budou obsahovat každý predikát pouze jednou."@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>

SELECT DISTINCT ?property
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [] a qb:Observation ;
      ?property [] .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:some-data a sp:Query ;
  rdfs:label "Jsou v úložišti data?"@cs ;
  rdfs:comment "Zjistěte, zdali jsou v dotazovaném úložišti data."@cs ;
  sp:text """
ASK {
  [] ?p [] .
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:some-named-graphs a sp:Query ;
  rdfs:label "Jsou v úložišti pojmenované grafy?"@cs ;
  rdfs:comment "Zjistěte, zdali jsou v dotazovaném úložišti pojmenované grafy."@cs ;
  sp:text """
ASK
WHERE {
  GRAPH ?g {
    [] ?p [] .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:count-triples a sp:Query ;
  rdfs:label "Počet trojic"@cs ;
  rdfs:comment "Spočtěte trojice ve výchozím grafu."@cs ;
  sp:text """
SELECT (COUNT(*) AS ?count)
WHERE {
  [] ?p [] .
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:graph-sizes a sp:Query ;
  rdfs:label "Velikost grafů"@cs ;
  rdfs:comment "Spočtěte trojice v každém grafu a seřaďte výsledky sestupně dle velikosti."@cs ;
  sp:text """
SELECT ?graph (COUNT(*) AS ?size)
WHERE {
  GRAPH ?graph {
    [] ?p [] .
  }
}
GROUP BY ?graph
ORDER BY DESC(?size)
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:component-property-subproperties a sp:Query ;
  rdfs:label "Predikáty odvozené z qb:componentProperty"@cs ;
  rdfs:comment "Vyberte predikáty z Data Cube Vocabulary (pojmenovaný graf `http://purl.org/linked-data/cube`), které jsou odvozené z `qb:componentProperty` pomocí `rdfs:subPropertyOf`."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?property
WHERE {
  GRAPH <http://purl.org/linked-data/cube> {
    ?property rdfs:subPropertyOf qb:componentProperty .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:count-datasets a sp:Query ;
  rdfs:label "Počet datasetů"@cs ;
  rdfs:comment "Spočtěte instance `qb:DataSet` ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`)."@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>

SELECT (COUNT(DISTINCT ?dataSet) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    ?dataSet a qb:DataSet .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:dataset-attributes a sp:Query ;
  rdfs:label "Atributy ve statistikách důchodů a důchodců"@cs ;
  rdfs:comment "Vyberte atributy (tj. instance `qb:AttributeProperty`), které jsou použity ve struktuře datové kostky statistik důchodů a důchodců (dataset a pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`)."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>

SELECT ?attribute
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure ?dsd .
    ?dsd qb:component [
      ?property ?attribute
    ] .
    ?attribute a qb:AttributeProperty .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:dataset-component-labels-czech a sp:Query ;
  rdfs:label "Názvy komponent datasetu statistik důchodů a důchodců v češtině"@cs ;
  rdfs:comment "Vyberte názvy komponent datasetu statistik důchodů a důchodců (dataset a pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`) v češtině. Výsledky seřaďte vzestupně dle volitelně uvedeného pořadí komponent (`qb:order`) ve struktuře datasetu. Názvy se nebudou opakovat."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?componentLabel
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure ?dsd .
    ?dsd qb:component ?component .
    ?component rdfs:label ?componentLabel .
    FILTER langMatches(lang(?componentLabel), "cs")
    OPTIONAL {
      ?component qb:order ?order .
    }
  }
}
ORDER BY ?order
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:dataset-component-properties-with-classes a sp:Query ;
  rdfs:label "Komponenty datasetu statistik důchodů a důchodců s třídami"@cs ;
  rdfs:comment "Vyberte komponenty datasetu statistik důchodů a důchodců (dataset a pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`) spolu s volitelně uvedenými třídami predikátů, na něž komponenty odkazují přes predikát odvozený z `qb:componentProperty` pomocí `rdfs:subPropertyOf` v Data Cube Vocabulary (pojmenovaný graf `http://purl.org/linked-data/cube`)."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?componentProperty ?class
WHERE {
  GRAPH <http://purl.org/linked-data/cube> {
    ?property rdfs:subPropertyOf qb:componentProperty .
  }
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure ?dsd .
    ?dsd qb:component [
      ?property ?componentProperty
    ] .
    OPTIONAL {
      ?componentProperty a ?class .
    }
  }
}
ORDER BY ?componentProperty
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:dataset-dimensions a sp:Query ;
  rdfs:label "Dimenze statistik důchodů a důchodců"@cs ;
  rdfs:comment "Vyberte dimenze (instance `qb:DimensionProperty`) ze struktury datasetu statistik důchodů a důchodců (dataset a pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Dimenze se nebudou ve výsledcích opakovat."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>

SELECT DISTINCT ?dimension
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure/qb:component/(qb:dimension|qb:componentProperty) ?dimension .
    ?dimension a qb:DimensionProperty .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:dataset-measures a sp:Query ;
  rdfs:label "Míry statistik důchodů a důchodců"@cs ;
  rdfs:comment "Vyberte míry (instance `qb:MeasureProperty`) ze struktury datasetu statistik důchodů a důchodců (dataset a pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Míry se nebudou ve výsledcích opakovat."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>

SELECT DISTINCT ?measure
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure/qb:component/(qb:measure|qb:componentProperty) ?measure .
    ?measure a qb:MeasureProperty .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:datasets a sp:Query ;
  rdfs:label "Datasety statistik důchodů a důchodců"@cs ;
  rdfs:comment "Vyberte datasety (instance `qb:DataSet`) statistik důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Výsledné datasety uveďte bez opakování."@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>

SELECT DISTINCT ?dataset
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    ?dataset a qb:DataSet .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:vocabularies a sp:Query ;
  rdfs:label "Slovníky"@cs ;
  rdfs:comment "Vyberte slovníky použité v datech statistik důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). Jako slovník berte jmenný prostor termínu instanciované třídy nebo použitého predikátu. Za jmenný prostor považujte část IRI termínů po poslední lomítko (`/`) nebo hash (`#`). Pro každý slovník vraťte počet rozdílných termínů a výsledky seřaďte sestupně dle tohoto počtu."@cs ;
  sp:text """
SELECT ?vocabulary (COUNT(*) AS ?count)
WHERE {
  {
    # Instanciované třídy
    SELECT DISTINCT ?term
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] a ?term .
      }
    }
  } UNION {
    # Použité predikáty
    SELECT DISTINCT ?term
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] ?term [] .
      }
    }
  }
  BIND (IRI(REPLACE(STR(?term), "^(.+)(#|\\\\/).+$", "$1")) AS ?vocabulary)
}
GROUP BY ?vocabulary
ORDER BY DESC(?count)
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:most-common-class-data a sp:Query ;
  rdfs:label "Nejčastěji instanciovaná třída ve statistikách důchodů a důchodců"@cs ;
  rdfs:comment "Vyberte třídu s nejvyšším počtem instancí ve statistikách důchodů a důchodců (pojmenovaný graf `https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech`). V případě, že by tříd s nejvyšším počtem instací bylo více, postačí vybrat jednu z nich."@cs ;
  sp:text """
SELECT ?class
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    ?s a ?class .
  }
}
GROUP BY ?class
ORDER BY DESC(?count)
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:ambiguous-notation-references a sp:Query ;
  rdfs:label "Jsou notace číselníkových konceptů víceznačné?"@cs ;
  rdfs:comment "Zjistěte, zdali jsou v číselnících (pojmenovaný graf `https://data.cssz.cz/resource/dataset/pomocne-ciselniky`) různé koncepty, které sdílí stejnou notaci (hodnotu `skos:notation`)."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?a skos:inScheme ?scheme ;
      skos:notation ?notation .
    ?b skos:inScheme ?scheme ;
      skos:notation ?notation .
    FILTER (!sameTerm(?a, ?b))
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:ambiguous-notation-references-construct a sp:Query ;
  rdfs:label "Víceznačné notace číselníkových konceptů"@cs ;
  rdfs:comment """Vyberte různé koncepty číselníků (pojmenovaný graf `https://data.cssz.cz/resource/dataset/pomocne-ciselniky`), které sdílí stejnou notaci (hodnotu `skos:notation`). Výsledkem bude RDF graf, v němž `?a` a `?b` jsou koncepty číselníku a `?notation` je notace, kterou sdílí."""@cs ;
  sp:text """
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX spin: <http://spinrdf.org/spin#>

CONSTRUCT {
  [] a spin:ConstraintViolation ;
    spin:violationRoot ?a, ?b ;
    spin:violationPath skos:notation ;
    spin:violationValue ?notation ;
    rdfs:comment "Concepts within the same concept scheme should not have identical skos:notation literals."@en ;
    rdfs:seeAlso <https://github.com/cmader/qSKOS/wiki/Quality-Issues#ambiguous-notation-references> .
}
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?a skos:inScheme ?scheme ;
      skos:notation ?notation .
    ?b skos:inScheme ?scheme ;
      skos:notation ?notation .
    FILTER (!sameTerm(?a, ?b))
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:cyclic-hierchical-relations a sp:Query ;
  rdfs:label "Jsou v číselnících cyklické hierarchické vztahy?"@cs ;
  rdfs:comment "Zjistěte, zdali jsou v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) cykly v transitivních hierarchických vztazích vyjádřených predikáty `skos:broaderTransitive` nebo `skos:narrowerTransitive`."@cs ;
  skos:note "O cyklickech v hierarchických vztazích v rámci číselníků se můžete dočíst ve specifikaci slovníku [SKOS](https://www.w3.org/TR/skos-reference/#L2484)."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    {
      ?concept skos:broaderTransitive+ ?concept .
    } UNION {
      ?concept skos:narrowerTransitive+ ?concept .
    }
  }
}
""" ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:empty-labels a sp:Query ;
  rdfs:label "Jsou v číselnících prázdné štítky?"@cs ;
  rdfs:comment "Zjistěte, zdali jsou v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) prázdné štítky; tj. objekty predikátů `skos:prefLabel`, `skos:altLabel` nebo `skos:hiddenLabel`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES ?labelProperty {
      skos:prefLabel
      skos:altLabel
      skos:hiddenLabel
    }
    [] ?labelProperty ?label .
    FILTER (STRLEN(?label) = 0)
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:incomplete-language-coverage a sp:Query ;
  rdfs:label "Je pokrytí štítků dle jazyků v číselnících neúplné?"@cs ;
  rdfs:comment "Zjistěte, zdali v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) je neúplné pokrytí štítků dle jazyků. Pokud je v určitém číselníku koncept se štítkem v určitém jazyce a existuje koncept téhož číselníku, který štítek v tomto jazyce postrádá, pak hovoříme o neúplném pokrytí dle jazyků. Jako štítky berte objekty predikátů `skos:prefLabel`, `skos:altLabel` a `skos:hiddenLabel`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  {
    SELECT ?scheme ?labelProperty ?language
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
        VALUES ?labelProperty {
          skos:prefLabel
          skos:altLabel
          skos:hiddenLabel
        }
        [] skos:inScheme ?scheme ;
          ?labelProperty ?label .
        BIND (lang(?label) AS ?language)
      }
    }
    GROUP BY ?scheme ?labelProperty ?language
  }
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?concept skos:inScheme ?scheme .
    FILTER NOT EXISTS {
      ?concept ?labelProperty ?label .
      FILTER (lang(?label) = ?language)
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:hard .

exercise:label-without-language a sp:Query ;
  rdfs:label "Jsou v číselnících štítky bez určení jazyka?"@cs ;
  rdfs:comment "Zjistěte, zdali se v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) vyskytují štítky s chybějícím tagem jazyka. Jako štítky berte objekty predikátů `skos:prefLabel`, `skos:altLabel` a `skos:hiddenLabel`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES ?labelProperty {
      skos:prefLabel
      skos:altLabel
      skos:hiddenLabel
    }
    [] ?labelProperty ?label .
    FILTER (lang(?label) = "")
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:omitted-top-concepts a sp:Query ;
  rdfs:label "Chybí v číselnících koncepty představujcí vrchol hierarchie?"@cs ;
  rdfs:comment "Zjistěte, zdali některé číselníky (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) postrádají koncepty představujcí vrchol hierarchie. Ty jsou buď odkázány z číselníku (instance `skos:ConceptScheme`) pomocí predikátu `skos:hasTopConcept` nebo naopak vrcholové koncepty odkazují na číselník pomocí inverzního predikátu `skos:topConceptOf`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?conceptScheme a skos:ConceptScheme .
    FILTER NOT EXISTS {
      ?conceptScheme skos:hasTopConcept|^skos:topConceptOf [] .
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:orphan-concepts a sp:Query ;
  rdfs:label "Jsou v číselnících osamocené koncepty?"@cs ;
  rdfs:comment "Zjistěte, zdali číselníky (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) obsahují osamocené koncepty. Osamocené koncepty jsou instance `skos:Concept`, které nejsou spojeny žádným sémantickým vztahem pomocí predikátů `skos:broader`, `skos:narrower`, `skos:related`, `skos:broaderTransitive`, `skos:narrowerTransitive`, `skos:topConceptOf` nebo `skos:hasTopConcept`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?concept a skos:Concept .
    FILTER NOT EXISTS {
      {
        VALUES ?semanticRelation {
          skos:broader
          skos:narrower
          skos:related
          skos:broaderTransitive
          skos:narrowerTransitive
        }
        {
          ?concept ?semanticRelation [] .
        } UNION {
          [] ?semanticRelation ?concept .
        }
      } UNION {
        ?concept skos:topConceptOf|^skos:hasTopConcept [] .
      }
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:pairwise-disjoint-skos-label-properties a sp:Query ;
  rdfs:label "Mají koncepty číselníků překrývající se štítky?"@cs ;
  rdfs:comment "Zjistěte, zdali číselníky (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) obsahují koncepty s překrývajícími se štítky. Tyto koncepty mají stejnou hodnotu pro kterýkoli pár predikáty `skos:prefLabel`, `skos:altLabel` nebo `skos:hiddenLabel`. Jde o integritní omezení [S13](https://www.w3.org/TR/skos-reference/#S13) slovníku SKOS."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    {
      ?concept skos:prefLabel ?label ;
        skos:altLabel ?label .
    } UNION {
      ?concept skos:altLabel ?label ;
        skos:hiddenLabel ?label .
    } UNION {
      ?concept skos:prefLabel ?label ;
        skos:hiddenLabel ?label .
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:multiple-pref-labels-per-language a sp:Query ;
  rdfs:label "Mají číselníkové koncepty více preferovaných štítků ve stejném jazyce?"@cs ;
  rdfs:comment "Zjistěte, zdali číselníky (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) obsahují koncepty s více hodnotami predikátu `skos:prefLabel` ve stejném jazyce. Jde o integritní omezení [S14](https://www.w3.org/TR/skos-reference/#S14) slovníku SKOS."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  {
    SELECT ?concept ?language
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
        ?concept skos:prefLabel ?prefLabel .
        BIND (lang(?prefLabel) AS ?language)
      }
    }
    GROUP BY ?concept ?language
    HAVING (COUNT(?prefLabel) > 1)
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:overlapping-associative-and-hierarchical-relations a sp:Query ;
  rdfs:label "Překrývají se v číselnících asociativní a hierarchické vztahy?"@cs ;
  rdfs:comment "Zjistěte, zdali se v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) překrývají asociativní (`skos:related`) a hierarchické (`skos:broaderTransitive` a `skos:narrowerTransitive`) vztahy. Pokud jsou koncepty propojeny asociativní vazbou, pak nemohou být propojeny hierarchickou vazbou, a to ani tranzitivně. Jde o integritní omezení [S27](https://www.w3.org/TR/skos-reference/#S27) slovníku SKOS."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?a skos:related ?b ;
      skos:broaderTransitive+|skos:narrowerTransitive+ ?b .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:collection-disjoint-with-concept-and-concept-scheme a sp:Query ;
  rdfs:label "Překrývají se kolekce s koncepty a konceptuálními schématy?"@cs ;
  rdfs:comment "Zjistěte, zdali se v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) překrývají instance `skos:Collection` s instancemi `skos:Concept` nebo `skos:ConceptScheme`. Jde o integritní omezení [S37](https://www.w3.org/TR/skos-reference/#S37) slovníku SKOS."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES ?disjointClass {
      skos:Concept
      skos:ConceptScheme
    }
    ?collection a skos:Collection, ?disjointClass .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:pairwise-disjoint-skos-match-properties a sp:Query ;
  rdfs:label "Překrývají se v číselnících linkovací predikáty?"@cs ;
  rdfs:comment "Zjistěte, zdali se v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) překrývají linkovací predikáty `skos:exactMatch`, `skos:broadMatch`, `skos:narrowMatch` a `skos:relatedMatch`. Pokud jsou koncepty propojeny pomocí predikátu `skos:exactMatch`, pak nemohou být současně propojeny pomocí `skos:broadMatch`, `skos:narrowMatch` nebo `skos:relatedMatch`. Jde o integritní omezení [S46](https://www.w3.org/TR/skos-reference/#S46) slovníku SKOS."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES ?disjointProperty {
      skos:broadMatch
      skos:narrowMatch
      skos:relatedMatch
    }
    ?a skos:exactMatch ?b ;
      ?disjointProperty ?b .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:disjoint-concept-and-concept-scheme a sp:Query ;
  rdfs:label "Překrývají se koncepty a konceptuální schémata?"@cs ;
  rdfs:comment "Zjistěte, zdali se v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) překrývají instance `skos:Concept` a `skos:ConceptScheme`. Jde o integritní omezení [S9](https://www.w3.org/TR/skos-reference/#S9) slovníku SKOS."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?s a skos:Concept, skos:ConceptScheme .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:top-concept-has-no-broader-concept a sp:Query ;
  rdfs:label "Mají koncepty představující vrchol hierearchie nadřazené koncepty?"@cs ;
  rdfs:comment "Zjistěte, zdali se v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) objevují chybné koncepty představující vrchol hierearchie, které mají nadřazené koncepty ve stejném konceptuálním schématu. Jako koncepty představující vrchol hierearchie berte ty, které odkazují na své schéma pomocí predikátu `skos:topConceptOf` nebo jsou ze schématu odkazovány pomocí predikátu `skos:hasTopConcept`. Nadřazené koncepty hledejte přes hierarchické predikáty `skos:broader`, `skos:broaderTransitive`, `skos:narrower` nebo `skos:narrowerTransitive`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?topConcept skos:topConceptOf|^skos:hasTopConcept ?scheme .
    {
      VALUES ?broaderProperty {
        skos:broader
        skos:broaderTransitive
      }
      ?topConcept ?broaderProperty ?broader .
    } UNION {
      VALUES ?narrowerProperty {
        skos:narrower
        skos:narrowerTransitive
      }
      ?broader ?narrowerProperty ?topConcept .
    }
    ?broader skos:inScheme ?scheme .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:unidirectionally-related-concepts a sp:Query ;
  rdfs:label "Jsou v číselnících jednosměrně propojené koncepty?"@cs ;
  rdfs:comment "Zjistěte, zdali v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) jsou jednosměrně propojené koncepty. Například, pokud jsou koncepty `A` a `B` jednosměrně propojeny predikátem `skos:broader`, pak neexistuje propojení `B skos:narrower A`. Použijte páry inverzních predikátů `skos:broader` a `skos:narrower`, `skos:broaderTransitive` a `skos:narrowerTransitive`, `skos:topConceptOf` a `skos:hasTopConcept`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES (?property ?inverseProperty) {
      (skos:broader skos:narrower)
      (skos:broaderTransitive skos:narrowerTransitive)
      (skos:topConceptOf skos:hasTopConcept)
    }
    {
      ?a ?property ?b .
      FILTER NOT EXISTS {
        ?b ?inverseProperty ?a .
      }
    } UNION {
      ?a ?inverseProperty ?b .
      FILTER NOT EXISTS {
        ?b ?property ?a .
      }
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:unprintable-characters-in-labels a sp:Query ;
  rdfs:label "Jsou ve štítcích konceptů netisknutelné znaky?"@cs ;
  rdfs:comment "Zjistěte, zdali v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) jsou štítky obsahující netisknutelné znaky. Jako štítky berte objekty predikátů `skos:prefLabel`, `skos:altLabel` a `skos:hiddenLabel`. Netisknutelné znaky jsou v Unicode kategoriích `Zl`, `Zp` a `C`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES ?labelProperty {
      skos:prefLabel
      skos:altLabel
      skos:hiddenLabel
    }
    [] ?labelProperty ?label .
    FILTER REGEX(?label, "^.*\\\\p{Zl}|\\\\p{Zp}|\\\\p{C}.*$")
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:valueless-associative-relations a sp:Query ;
  rdfs:label "Jsou v číselnících nadbytečné asociativní vztahy?"@cs ;
  rdfs:comment "Zjistěte, zdali v číselnících (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`) jsou sourozenci sdílející nadřazený koncept nadbytečně propojeni asociativní vazbou `skos:related`."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    [] skos:narrower ?a, ?b .
    {
      ?a skos:related ?b .
    } UNION {
      ?b skos:related ?a .
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:has-dsd a sp:Query ;
  rdfs:label "Chybějící popis struktury dat"@cs ;
  rdfs:comment """Najděte v datech o statistikách důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`) struktury dat (<abbr class="initialism" title="Data Structure Definition">DSD</abbr>) odkazované z pozorování, pro něž není znám jejich popis; tzn. neexistuje trojice se strukturou dat v roli subjektu."""@cs ;
  sp:text """
PREFIX qb:    <http://purl.org/linked-data/cube#>
PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
PREFIX spin:  <http://spinrdf.org/spin#>

CONSTRUCT {
  [] a spin:ConstraintViolation ;
    spin:violationRoot ?dsd ;
    rdfs:comment "Missing description of data structure definition."@en .
}
WHERE {
  {
    SELECT DISTINCT ?dsd
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] a qb:Observation ;
          qb:dataSet/qb:structure ?dsd .
        FILTER NOT EXISTS {
          ?dsd ?p [] .
        }
      }
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:dsd-has-normal-form a sp:Query ;
  rdfs:label "Mají datové struktury popsané DCV normalizovanou podobu?"@cs ;
  rdfs:comment """Zjistěte, zdali data o statistikách důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`) jsou datové struktury (<abbr class="initialism" title="Data Structure Definition">DSD</abbr>) v [normalizované podobě](https://www.w3.org/TR/vocab-data-cube/#h2_normalize)."""@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [] a qb:DataStructureDefinition ;
      qb:component ?component .
    FILTER NOT EXISTS {
      ?component qb:componentAttachment ?componentAttachment .
      FILTER (!sameTerm(?componentAttachment, qb:Observation))
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:understanding-from a sp:Query ;
  rdfs:label "Spočtěte trojice ve slovníku statistik důchodů a důchodců s využitím klauzule FROM"@cs ;
  rdfs:comment "Spočtěte trojice ve slovníku statistik důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/rocenka/vocabulary>`). Použijte při tom klauzuli FROM."@cs ;
  dcterms:requires sp:from ;
  sparqlab:prohibits sp:fromNamed, sp:NamedGraph ;
  sp:text """
SELECT (COUNT(*) AS ?count)
FROM <https://data.cssz.cz/resource/dataset/rocenka/vocabulary>
WHERE {
  [] ?p [] .
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:understanding-from-named a sp:Query ;
  rdfs:label "Spočtěte trojice ve slovníku statistik důchodů a důchodců s využitím klauzule FROM NAMED"@cs ;
  rdfs:comment "Spočtěte trojice ve slovníku statistik důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/rocenka/vocabulary>`). Použijte při tom klauzuli FROM NAMED."@cs ;
  dcterms:requires sp:fromNamed ;
  sparqlab:prohibits sp:from ;
  sp:text """
SELECT (COUNT(*) AS ?count)
FROM NAMED <https://data.cssz.cz/resource/dataset/rocenka/vocabulary>
WHERE {
  GRAPH ?g {
    [] ?p [] .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:understanding-graph a sp:Query ;
  rdfs:label "Spočtěte trojice ve slovníku statistik důchodů a důchodců s využitím klauzule GRAPH"@cs ;
  rdfs:comment "Spočtěte trojice ve slovníku statistik důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/rocenka/vocabulary>`). Použijte při tom klauzuli GRAPH."@cs ;
  dcterms:requires sp:NamedGraph ;
  sparqlab:prohibits sp:from, sp:fromNamed ;
  sp:text """
SELECT (COUNT(*) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/rocenka/vocabulary> {
    [] ?p [] .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:comparing-from-and-graph a sp:Query ;
  rdfs:label "Jsou počty trojic ve slovníku statistik důchodů a důchodců shodné při použití klauzulí FROM, FROM NAMED a GRAPH?"@cs ;
  rdfs:comment "Spočtěte trojice ve slovníku statistik důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/rocenka/vocabulary>`) třemi způsoby s využitím klauzulí FROM, FROM NAMED a GRAPH a ověřte, že se součty rovnají."@cs ;
  dcterms:requires sp:NamedGraph, sp:from, sp:fromNamed ;
  sp:text """
ASK
FROM <https://data.cssz.cz/resource/dataset/rocenka/vocabulary>
FROM NAMED <https://data.cssz.cz/resource/dataset/rocenka/vocabulary>
WHERE {
  {
    SELECT (COUNT(*) AS ?count)
    WHERE {
      [] ?p [] .
    }
  }
  {
    SELECT (COUNT(*) AS ?count)
    WHERE {
      GRAPH ?g {
        [] ?p [] .
      }
    }
  }
  {
    SELECT (COUNT(*) AS ?count)
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/rocenka/vocabulary> {
        [] ?p [] .
      }
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:count-distinct-classes a sp:Query ;
  rdfs:label "Kolik různých tříd je instanciováno?"@cs ;
  rdfs:comment "Spočtěte různé třídy, jejichž instance jsou v datech o statistikách důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`)."@cs ;
  sp:text """
SELECT (COUNT(DISTINCT ?class) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [] a ?class .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:count-distinct-classes-without-distinct a sp:Query ;
  rdfs:label "Kolik různých tříd je instanciováno (bez DISTINCT)?"@cs ;
  rdfs:comment "Spočtěte různé třídy, jejichž instance jsou v datech o statistikách důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`) bez použití modifikátoru `DISTINCT`."@cs ;
  sparqlab:prohibits sp:distinct ;
  sp:text """
SELECT (COUNT(?class) AS ?count)
WHERE {
  {
    SELECT ?class
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] a ?class .
      }
    }
    GROUP BY ?class
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:count-distinct-classes-with-reduced a sp:Query ;
  rdfs:label "Kolik různých tříd je instanciováno (pomocí REDUCED)?"@cs ;
  rdfs:comment "Spočtěte různé třídy, jejichž instance jsou v datech o statistikách důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`) s použitím modifikátoru `REDUCED`."@cs ;
  dcterms:requires sp:reduced ;
  sparqlab:prohibits sp:distinct, sp:groupBy ;
  sp:text """
SELECT (COUNT(?class) AS ?count)
WHERE {
  {
    SELECT REDUCED ?class
    WHERE {
      {
        SELECT ?class
        WHERE {
          GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
            [] a ?class .
          }
        }
        ORDER BY ?class
      }
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal ;
  skos:note "Implementace `REDUCED` je do značné míry ponechána na RDF úložištích, proto můžete v různých úložištích získat odlišné výsledky pro stejný dotaz s `REDUCED`."@cs .

exercise:reflexive-exact-match a sp:Query ;
  rdfs:label "Reflexivní skos:exactMatch"@cs ;
  rdfs:comment "Najděte koncepty číselníků (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`), které jsou spojeny samy se sebou přesnou shodou pomocí `skos:exactMatch`. Vyhovující koncepty uveďte bez opakování."@cs ;
  sp:text """
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

SELECT DISTINCT ?concept
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?concept skos:exactMatch ?concept .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:czech-county-labels a sp:Query ;
  rdfs:label "Názvy okresů"@cs ;
  rdfs:comment "Vypište názvy okresů z číselníků (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`). Okresy jsou uvedeny jako instance třídy `ruian:Okres` a jejich názvy reprezentuje vlastnost `skos:prefLabel`. Názvy okresů vypište bez opakování."@cs ;
  sp:text """
PREFIX ruian: <https://data.cssz.cz/ontology/ruian/>
PREFIX skos:  <http://www.w3.org/2004/02/skos/core#>

SELECT DISTINCT ?label
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    [] a ruian:Okres ;
      skos:prefLabel ?label .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:count-pension-kinds a sp:Query ;
  rdfs:label "Počet druhů důchodů"@cs ;
  rdfs:comment "Spočtěte, kolik druhů důchodů se nachází v číselníku druhů důchodů z roku 2008 (`<http://data.cssz.cz/ontology/pension-kinds/PensionKindScheme_2008>`). Číselník najdete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`)."@cs ;
  sp:text """
PREFIX pen-onto: <http://data.cssz.cz/ontology/pension-kinds/>
PREFIX skos:     <http://www.w3.org/2004/02/skos/core#>

SELECT (COUNT(DISTINCT ?concept) AS ?count)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?concept skos:inScheme pen-onto:PensionKindScheme_2008 .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:pension-kind-schemes a sp:Query ;
  rdfs:label "Číselníky druhů důchodů"@cs ;
  rdfs:comment "Najděte číselníky druhů důchodů. Koncepty těchto číselníků jsou instancemi třídy `pen-onto:PensionKind`. Číselníky najdete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`)."@cs ;
  sp:text """
PREFIX pen-onto: <http://data.cssz.cz/ontology/pension-kinds/>
PREFIX skos:     <http://www.w3.org/2004/02/skos/core#>

SELECT DISTINCT ?pensionKindScheme
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    [] a pen-onto:PensionKind ;
      skos:inScheme ?pensionKindScheme .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:ref-area-classes a sp:Query ;
  rdfs:label "Třídy referenčních oblastí"@cs ;
  rdfs:comment "Najděte třídy referenčních oblastí odkazovaných ve statistikách důchodů a důchodců (pojmenovaný graf `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`). Referenční oblasti jsou objekty vlastnosti `cssz-dimension:refArea`. Třídy referenčních oblastí najdete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`. Výsledky vypište bez opakování."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>

SELECT DISTINCT ?class
WHERE {
  {
    SELECT DISTINCT ?refArea
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] cssz-dimension:refArea ?refArea .
      }
    }
  }
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?refArea a ?class .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:old-age-pension-kinds a sp:Query ;
  rdfs:label "Koncepty starobního důchodu"@cs ;
  rdfs:comment "Najděte koncepty starobního důchodu, které odkazují na koncept `pension-kind:PK_old_age_total_without_SR` pomocí `skos:exactMatch`. Koncepty starobního důchodu jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX pension-kind: <https://data.cssz.cz/resource/pension-kind/>
PREFIX skos:         <http://www.w3.org/2004/02/skos/core#>

SELECT ?pensionKind
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:is-pension-kinds-2008-polyhierarchical a sp:Query ;
  rdfs:label "Je číselník druhů důchodů z roku 2008 polyhierarchický?"@cs ;
  rdfs:comment "Zjistěte, zdali je číselník druhů důchodů z roku 2008 (`pen-onto:PensionKindScheme_2008`) polyhierarchický. Číselník naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  skos:note "Polyhierarchické číselníky obsahují koncepty, které mají více než jeden nadřazený koncept."@cs ;
  sp:text """
PREFIX pen-onto: <http://data.cssz.cz/ontology/pension-kinds/>
PREFIX skos:     <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  {
    SELECT ?concept
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
        ?concept skos:inScheme pen-onto:PensionKindScheme_2008 .
        ?broader skos:narrower ?concept .
      }
    }
    GROUP BY ?concept
    HAVING (COUNT(DISTINCT ?broader) > 1)
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:pensions-rounded-to-thousands a sp:Query ;
  rdfs:label "Důchody zaokrouhlené na tisíce"@cs ;
  rdfs:comment "Získejte průměrnou výši starobních důchodů pro Českou republiku (referenční oblast `<https://data.cssz.cz/resource/ruian/staty/1>`) aritmeticky zaokrouhlenou na tisíce. Jako druh důchodu použijte shodné koncepty s `pension-kind:PK_old_age_total_without_SR` z pojmenovaného grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`. Vyberte průměrnou výši důchodů pro všechna pohlaví (`sdmx-code:sex-T`). Výše starobních důchodů se nacházejí v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Výsledky seřaďte bez opakování sestupně dle 4-místného literálu roku průměrného důchodu."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX qb:             <http://purl.org/linked-data/cube#>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>
PREFIX xsd:            <http://www.w3.org/2001/XMLSchema#>

SELECT DISTINCT (ROUND(?pension / ?factor) * ?factor AS ?roundedPension) ?year
WHERE {
 GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
   ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .
 }
 GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
   [] a qb:Observation ;
     qb:dataSet <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> ;
     cssz-dimension:pohlavi sdmx-code:sex-T ;
     cssz-dimension:refArea <https://data.cssz.cz/resource/ruian/staty/1> ;
     cssz-dimension:refPeriod ?refPeriod ;
     cssz-dimension:druh-duchodu ?pensionKind ;
     cssz-measure:prumerna-vyse-duchodu-v-kc ?pension .
  }
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?refPeriod skos:notation ?date .
    BIND(YEAR(STRDT(?date, xsd:date)) AS ?year)
  }
  BIND (1000 AS ?factor)
}
ORDER BY ?year
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:dataset-equals-named-graph a sp:Query ;
  rdfs:label "Překrývají se IRI datasetů a pojmenovaných grafů?"@cs ;
  rdfs:comment "Zjistěte, zdali se IRI některých datasetů (instancí `qb:DataSet`) překrývají s IRI pojmenovaných grafů."@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>

ASK
WHERE {
  GRAPH ?dataset {
    ?dataset a qb:DataSet .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:data-structure-definition a sp:Query ;
  rdfs:label "Datová struktura statistik důchodů a důchodců"@cs ;
  rdfs:comment "Najděte datovou strukturu datasetu statistik důchodů a důchodců (`<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`) připojenou pomocí predikátu `qb:structure`. Data o statistikách důchodů a důchodců naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`."@cs ;
  sp:text """
PREFIX qb: <http://purl.org/linked-data/cube#>

SELECT ?dsd
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure ?dsd .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:dsd-components a sp:Query ;
  rdfs:label "Komponenty datové struktury statistik důchodů a důchodců"@cs ;
  rdfs:comment "Vypište komponenty datové struktury statistik důchodů a důchodců (`<https://data.cssz.cz/resource/data-structure-definition/duchodci-v-cr-krajich-okresech>`). Komponenty jsou z datové struktury odkazovány predikátem `qb:structure`. Pro každý komponent vypište jeho český název (`rdfs:label`), vlastnost komponentu, volitelnou úroveň přiřazení (`qb:componentAttachment`) a volitelně uvedení, zdali je komponent povinný (`qb:componentRequired`). Predikáty odkazující na vlastnosti komponent vezměte jako podřazené predikáty (`rdfs:subPropertyOf`) predikátu `qb:componentProperty` (včetně tohoto predikátu) z pojmenovaného grafu `<http://purl.org/linked-data/cube>`. Jako výchozí hodnotu úrovně přiřazení uveďte `qb:Observation`. Výchozí hodnotou indikátoru povinnosti komponentu je v případě atributů `false`, v ostatních případech `true`. Komponenty seřaďte vzestupně dle volitelně uvedeného pořadí (`qb:order`). Data o statistikách důchodů a důchodců naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?componentProperty ?label ?componentAttachment ?componentRequired
WHERE {
  GRAPH <http://purl.org/linked-data/cube> {
    ?property rdfs:subPropertyOf* qb:componentProperty .
  }
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    <https://data.cssz.cz/resource/data-structure-definition/duchodci-v-cr-krajich-okresech> qb:component ?component .
    ?component ?property ?componentProperty ;
      rdfs:label ?label .
    FILTER langMatches(lang(?label), "cs")

    OPTIONAL {
      ?component qb:order ?order .
    }

    OPTIONAL {
      ?component qb:componentAttachment ?_componentAttachment .
    }
    BIND (COALESCE(?_componentAttachment, qb:Observation) AS ?componentAttachment)

    OPTIONAL {
      ?component qb:componentRequired ?_componentRequired .
    }
    {
      FILTER (sameTerm(?property, qb:attribute) || EXISTS { ?componentProperty a qb:AttributeProperty . })
      BIND (false AS ?defaultComponentRequired)
    } UNION {
      BIND (true AS ?defaultComponentRequired)
    }
    BIND (COALESCE(?_componentRequired, ?defaultComponentRequired) AS ?componentRequired)
  }
}
ORDER BY ?order
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:is-multimeasure-dataset a sp:Query ;
  rdfs:label "Obsahuje dataset statistik důchodů a důchodců více měr?"@cs ;
  rdfs:comment "Zjistěte, zdali dataset statistik důchodů a důchodců (<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>) uvádí pro svá pozorování více druhů měr. Míry jsou ve struktuře datasetu uvedeny buď jako objekty `qb:measure` nebo `qb:componentProperty`, pokud instanciují `qb:MeasureProperty`. Data o statistikách důchodů a důchodců naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>

ASK
WHERE {
  {
    SELECT ?dsd
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> qb:structure ?dsd .
        ?dsd qb:component ?component .
        {
          ?component qb:measure ?measureProperty .
        } UNION {
          ?component qb:componentProperty ?measureProperty .
          ?measureProperty a qb:MeasureProperty .
        }
      }
    }
    GROUP BY ?dsd
    HAVING (COUNT(DISTINCT ?measureProperty) > 1)
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:component-properties-with-most-specific-classes a sp:Query ;
  rdfs:label "Nejspecifičtější třídy vlastnostní komponent"@cs ;
  rdfs:comment "Vypište nejspecifičtější třídy instanciované vlastnostmi komponent datové struktury statistik důchodů a důchodců (`<https://data.cssz.cz/resource/data-structure-definition/duchodci-v-cr-krajich-okresech>`). Predikáty připojující vlastnosti ke komponentám datové struktury vezměte jako vlastnosti odvozené z `qb:componentProperty` pomocí `rdfs:subPropertyOf` včetně samotné `qb:componentProperty`. Tyto odvozené vlastnosti definované slovníkem Data Cube Vocabulary naleznete v pojmenovaném grafu `<http://purl.org/linked-data/cube>`. Dejte pozor na to, že třída vlastnosti komponenty nemusí být uvedena. Vyberte pouze nejspecifičtější třídy, které nemají žádné     podtřídy odkazované pomocí `rdfs:subClassOf`. Data o statistikách důchodů a důchodců najdete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`."@cs ;
  sp:text """
PREFIX qb:   <http://purl.org/linked-data/cube#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?componentProperty ?class
FROM <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>
FROM <http://purl.org/linked-data/cube>
WHERE {
  ?property rdfs:subPropertyOf* qb:componentProperty .
  <https://data.cssz.cz/resource/data-structure-definition/duchodci-v-cr-krajich-okresech> qb:component [
    ?property ?componentProperty
  ] .
  OPTIONAL {
    ?componentProperty a ?class .
    FILTER NOT EXISTS {
      [] rdfs:subClassOf ?class .
    }
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:pension-kinds-2008-depth a sp:Query ;
  rdfs:label "Hloubka hierarchie druhů důchodů z roku 2008"@cs ;
  rdfs:comment "Spočtěte maximální hloubku hierarchie druhů důchodů z roku 2008 (`pen-onto:PensionKindScheme_2008`). Data o tomto číselníku naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX pen-onto: <http://data.cssz.cz/ontology/pension-kinds/>
PREFIX skos:     <http://www.w3.org/2004/02/skos/core#>

SELECT (COUNT(?mid) AS ?depth)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?a skos:inScheme pen-onto:PensionKindScheme_2008 ;
      skos:narrower* ?mid .
    ?mid skos:inScheme pen-onto:PensionKindScheme_2008 ;
      skos:narrower+ ?b .
    ?b skos:inScheme pen-onto:PensionKindScheme_2008 .
  }
}
GROUP BY ?a ?b
ORDER BY DESC(?depth)
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:hard .

exercise:path-between-pension-kinds a sp:Query ;
  rdfs:label "Cesta mezi druhy důchodů"@cs ;
  rdfs:comment "Vypište prvky cesty mezi konceptem pro důchody celkem včetně netypických výplat (`pension-kind:PK_total_without_special_pensions_2008`) a konceptem pro starobní důchod S (`pension-kind:PK_S_2008`). Prvky cesty jsou propojeny predikátem `skos:narrower`. Výsledná cesta obsahuje také svůj počáteční a koncový uzel. Číselník druhů důchodů naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX pension-kind: <https://data.cssz.cz/resource/pension-kind/>
PREFIX skos:          <http://www.w3.org/2004/02/skos/core#>

SELECT ?member
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    pension-kind:PK_total_without_special_pensions_2008 skos:narrower* ?member .
    ?member skos:narrower* pension-kind:PK_S_2008 .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:pension-kind-with-most-children a sp:Query ;
  rdfs:label "Druh důchodu s nejvíce dceřinnými koncepty"@cs ;
  rdfs:comment "Najděte druh důchodu s nejvíce dceřinými koncepty. Berte v potaz druhy důchodů z číselníku `pen-onto:PensionKindScheme_2008`. Číselník druhů důchodů naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX pen-onto: <http://data.cssz.cz/ontology/pension-kinds/>
PREFIX skos:     <http://www.w3.org/2004/02/skos/core#>

SELECT ?pensionKind
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?pensionKind skos:inScheme pen-onto:PensionKindScheme_2008 ;
      skos:narrower ?child .
  }
}
GROUP BY ?pensionKind
ORDER BY DESC(COUNT(DISTINCT ?child))
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:easy .

exercise:pension-kind-with-most-descendants a sp:Query ;
  rdfs:label "Druh důchodu s nejvíce potomky"@cs ;
  rdfs:comment "Najděte druh důchodu s nejvíce potomky, kteří jsou mu tranzitivně podřazeni pomocí `skos:narrower`. Berte v potaz druhy důchodů z číselníku `pen-onto:PensionKindScheme_2008`. Číselník druhů důchodů naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX pen-onto: <http://data.cssz.cz/ontology/pension-kinds/>
PREFIX skos:     <http://www.w3.org/2004/02/skos/core#>

SELECT ?pensionKind
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?pensionKind skos:inScheme pen-onto:PensionKindScheme_2008 ;
      skos:narrower+ ?descendant .
  }
}
GROUP BY ?pensionKind
ORDER BY DESC(COUNT(DISTINCT ?descendant))
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:hierarchical-code-lists a sp:Query ;
  rdfs:label "Hierarchické číselníky"@cs ;
  rdfs:comment "Najděte číselníky, které obsahují hierarchické vazby. Hierarchické vazby jsou reprezentovány predikáty `skos:broader`, `skos:broaderTransitive`, `skos:narrower` nebo `skos:narrowerTransitive`. Číselníky naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX skos:    <http://www.w3.org/2004/02/skos/core#>

SELECT DISTINCT ?conceptScheme
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    VALUES ?hierarchicalProperty {
      skos:broader
      skos:broaderTransitive
      skos:narrower
      skos:narrowerTransitive
    }
    ?conceptScheme a skos:ConceptScheme .
    [ skos:inScheme ?conceptScheme ] ?hierarchicalProperty [ skos:inScheme ?conceptScheme ] .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:orphan-count-over-time a sp:Query ;
  rdfs:label "Počet sirotků v čase"@cs ;
  rdfs:comment "Zjistěte, jak se měnil počet sirotků v čase. Pro každý rok uveďte počet sirotků pobírajících důchod ekvivalentní (`skos:exactMatch`) druhu důchodu `pension-kind:PK_D` pro všechna pohlaví (`<https://data.cssz.cz/ontology/sdmx/code/sex-T>`) a celou Českou republiku (`<https://data.cssz.cz/resource/ruian/staty/1>`). Výsledky uveďte bez opakování a seřaďte vzestupně dle roku. Data o počtech sirotků naleznete v pojmenovaném grafu  `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Data číselníků jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX qb:             <http://purl.org/linked-data/cube#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>
PREFIX xsd:            <http://www.w3.org/2001/XMLSchema#>

SELECT DISTINCT ?year ?orphanCount
FROM <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>
FROM <https://data.cssz.cz/resource/dataset/pomocne-ciselniky>
WHERE {
  [] a qb:Observation ;
    cssz-dimension:druh-duchodu/skos:exactMatch pension-kind:PK_D ;
    cssz-dimension:pohlavi <https://data.cssz.cz/ontology/sdmx/code/sex-T> ;
    cssz-dimension:refArea <https://data.cssz.cz/resource/ruian/staty/1> ;
    cssz-dimension:refPeriod/skos:notation ?refPeriod ;
    cssz-measure:pocet-duchodcu ?orphanCount .

  BIND (year(strdt(?refPeriod, xsd:date)) AS ?year)
}
ORDER BY ?year
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:greatest-gender-pay-gap a sp:Query ;
  rdfs:label "Největší rozdíl v důchodech mužů a žen"@cs ;
  rdfs:comment "Najděte největší rozdíl v důchodech mužů a žen. Rozdíl počítejte jako relativní podílem mezi důchodem žen a důchodem mužů. Jako druhy důchodu berte v potaz ekvivalenty `pension-kind:PK_old_age_total_without_SR`. Pro největší rozdíl získejte název jeho refereční oblasti a rok. Data statistik důchodů a důchodců naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Data číselníků jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX qb:             <http://purl.org/linked-data/cube#>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>
PREFIX xsd:            <http://www.w3.org/2001/XMLSchema#>

SELECT ?refAreaLabel ?year ?genderPayGap
WHERE {
  {
    SELECT ?refArea ?refPeriod ?genderPayGap
    WHERE {
      GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
        ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .
      }
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] cssz-dimension:pohlavi sdmx-code:sex-F ;
          cssz-dimension:druh-duchodu ?pensionKind ;
          cssz-dimension:refArea ?refArea ;
          cssz-dimension:refPeriod ?refPeriod ;
          cssz-measure:prumerna-vyse-duchodu-v-kc ?averagePensionWomen .

        [] cssz-dimension:pohlavi sdmx-code:sex-M ;
          cssz-dimension:druh-duchodu ?pensionKind ;
          cssz-dimension:refArea ?refArea ;
          cssz-dimension:refPeriod ?refPeriod ;
          cssz-measure:prumerna-vyse-duchodu-v-kc ?averagePensionMen .
      }
      BIND (?averagePensionWomen/?averagePensionMen AS ?genderPayGap)
    }
    ORDER BY ?genderPayGap
    LIMIT 1
  }
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?refPeriod skos:notation ?date .
    BIND (year(strdt(?date, xsd:date)) AS ?year)
    ?refArea skos:prefLabel ?refAreaLabel .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:greatest-range-of-pensions-between-areas a sp:Query ;
  rdfs:label "Největší rozdíl mezi důchody v různých oblastech"@cs ;
  rdfs:comment "Najděte největší rozdíl mezi důchody v různých oblastech. Berte v potaz starobní důchody, které jsou označeny jako ekvivalentní (`skos:exactMatch`) druhu `pension-kind:PK_old_age_total_without_SR`. Data o výších důchodu naleznete v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Data o číselnících druhů důchodů jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>

SELECT (MAX(?pension) - MIN(?pension) AS ?pensionRange)
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .
  }
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [] cssz-dimension:pohlavi ?gender ;
      cssz-dimension:druh-duchodu ?pensionKind ;
      cssz-dimension:refPeriod ?refPeriod ;
      cssz-measure:prumerna-vyse-duchodu-v-kc ?pension .
  }
}
GROUP BY ?gender ?refPeriod
ORDER BY ?pensionRange
LIMIT 1
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:greatest-increase-in-orphans a sp:Query ;
  rdfs:label "Největší meziroční nárůst počtu sirotků"@cs ;
  rdfs:comment "Najděte největší meziroční nárůst sirotků. Jako sirotky berte příjemce druhů důchodů ekvivalentních s `pension-kind:PK_D`. Data pro období, za něž jsou počty sirotků uváděny, najdete v číselníku `<https://data.cssz.cz/ontology/dates/DatesScheme>`. Meziroční nárůst vypočtěte v procentech jako rozdíl počtů sirotků ve dvou následných letech vydělený počtem sirotků v počátečním roce. Pro nalezenou referenční oblast uveďte název (`skos:prefLabel`). Pro počáteční a konečný rok uveďte jejich koncová data (`skos:notation`). Počty sirotků se nacházejí v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Číselníky jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX qb:             <http://purl.org/linked-data/cube#>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>
PREFIX xsd:            <http://www.w3.org/2001/XMLSchema#>

SELECT ?refAreaLabel ?startDate ?endDate ?increase
WHERE {
  {
    SELECT ?refArea ?start ?end ?increase
    WHERE {
      {
        SELECT ?end ?start
        WHERE {
          GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
            ?end skos:inScheme <https://data.cssz.cz/ontology/dates/DatesScheme> ;
              skos:notation ?endNotation .
            FILTER STRENDS(?endNotation, "-12-31")
            BIND (CONCAT(STR(xsd:integer(SUBSTR(?endNotation, 1, 4)) - 1), "-12-31") AS ?startNotation)
            ?start skos:inScheme <https://data.cssz.cz/ontology/dates/DatesScheme> ;
              skos:notation ?startNotation .
          }
        }
      }
      GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
        ?pensionKind skos:exactMatch pension-kind:PK_D .
      }
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] cssz-dimension:pohlavi sdmx-code:sex-T ;
          cssz-dimension:refArea ?refArea ;
          cssz-dimension:refPeriod ?end ;
          cssz-dimension:druh-duchodu ?pensionKind ;
          cssz-measure:pocet-duchodcu ?endCount .

        [] cssz-dimension:pohlavi sdmx-code:sex-T ;
          cssz-dimension:refArea ?refArea ;
          cssz-dimension:refPeriod ?start ;
          cssz-dimension:druh-duchodu ?pensionKind ;
          cssz-measure:pocet-duchodcu ?startCount .

        FILTER (?endCount > ?startCount)
        BIND ((?endCount - ?startCount)/?startCount AS ?increase)
      }
    }
    ORDER BY DESC(?increase)
    LIMIT 1
  }
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?refArea skos:prefLabel ?refAreaLabel .
    ?start skos:notation ?startDate .
    ?end skos:notation ?endDate .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:hard .

exercise:greatest-increase-in-pensions a sp:Query ;
  rdfs:label "Největší meziroční nárůst důchodů"@cs ;
  rdfs:comment "Najděte kde a kdy došlo k největšímu meziročnímu nárůstu starobních důchodů. Jako starobní důchody berte příjemce druhů důchodů ekvivalentních s `pension-kind:PK_old_age_total_without_SR`. Data pro období, za něž jsou výše důchodů uváděny, najdete v číselníku `<https://data.cssz.cz/ontology/dates/DatesScheme>`. Meziroční nárůst vypočtěte v procentech jako rozdíl výší důchodů ve dvou následných letech vydělený výší důchodu v počátečním roce. Pro nalezenou referenční oblast uveďte název (`skos:prefLabel`). Pro počáteční a konečný rok uveďte jejich koncová data (`skos:notation`). Výše důchodů se nacházejí v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Číselníky jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX qb:             <http://purl.org/linked-data/cube#>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>
PREFIX xsd:            <http://www.w3.org/2001/XMLSchema#>

SELECT ?refAreaLabel ?startDate ?endDate ?increase
WHERE {
  {
    SELECT ?refArea ?start ?end ?increase
    WHERE {
      {
        SELECT ?end ?start
        WHERE {
          GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
            ?end skos:inScheme <https://data.cssz.cz/ontology/dates/DatesScheme> ;
              skos:notation ?endNotation .
            FILTER STRENDS(?endNotation, "-12-31")
            BIND (CONCAT(STR(xsd:integer(SUBSTR(?endNotation, 1, 4)) - 1), "-12-31") AS ?startNotation)
            ?start skos:inScheme <https://data.cssz.cz/ontology/dates/DatesScheme> ;
              skos:notation ?startNotation .
          }
        }
      }
      GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
        ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .
      }
      GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
        [] cssz-dimension:pohlavi sdmx-code:sex-T ;
          cssz-dimension:refArea ?refArea ;
          cssz-dimension:refPeriod ?end ;
          cssz-dimension:druh-duchodu ?pensionKind ;
          cssz-measure:prumerna-vyse-duchodu-v-kc ?endPension .

        [] cssz-dimension:pohlavi sdmx-code:sex-T ;
          cssz-dimension:refArea ?refArea ;
          cssz-dimension:refPeriod ?start ;
          cssz-dimension:druh-duchodu ?pensionKind ;
          cssz-measure:prumerna-vyse-duchodu-v-kc ?startPension .

        FILTER (?endPension > ?startPension)
        BIND ((?endPension - ?startPension)/?startPension AS ?increase)
      }
    }
    ORDER BY DESC(?increase)
    LIMIT 1
  }
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?refArea skos:prefLabel ?refAreaLabel .
    ?start skos:notation ?startDate .
    ?end skos:notation ?endDate .
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:hard .

exercise:are-there-regions-with-women-older-than-men a sp:Query ;
  rdfs:label "Existují regiony s průměrně staršími důchodkyněmi než důchodci?"@cs ;
  rdfs:comment "Zjistěte, zdali existují regiony, v nichž byl někdy průměrný věk důchodkyň vyšší než průměrný věk důchodců. Berte v potaz důchodce pobírající druh důchodu ekvivalentní s `pension-kind:PK_old_age_total_without_SR`. Průměrný věk důchodců se nachází v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Číselníky jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX qb:             <http://purl.org/linked-data/cube#>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>

ASK
WHERE {
  GRAPH <https://data.cssz.cz/resource/dataset/pomocne-ciselniky> {
    ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .
  }
  GRAPH <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech> {
    [] cssz-dimension:pohlavi sdmx-code:sex-F ;
      cssz-dimension:druh-duchodu ?pensionKind ;
      cssz-dimension:refArea ?refArea ;
      cssz-dimension:refPeriod ?refPeriod ;
      cssz-measure:prumerny-vek ?averageAgeWomen .

    [] cssz-dimension:pohlavi sdmx-code:sex-M ;
      cssz-dimension:druh-duchodu ?pensionKind ;
      cssz-dimension:refArea ?refArea ;
      cssz-dimension:refPeriod ?refPeriod ;
      cssz-measure:prumerny-vek ?averageAgeMen .

    FILTER (?averageAgeWomen > ?averageAgeMen)
  }
}
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:poorest-prague-districts-over-time a sp:Query ;
  rdfs:label "Nejchudší městské části Prahy v čase"@cs ;
  rdfs:comment "Najděte městské části Prahy, kde v jednotlivých letech byl nejnižší starobní důchod. Pro každý rok vypište datum (`skos:notation`), název nejchudší městské části (`skos:prefLabel`) a průměrnou výši důchodů. Berte v potaz důchody ekvivalentní s `pension-kind:PK_old_age_total_without_SR`. Výše důchodů se nachází v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Číselníky jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX ruian:          <https://data.cssz.cz/ontology/ruian/>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>
PREFIX xsd:            <http://www.w3.org/2001/XMLSchema#>

SELECT ?date ?pragueDistrict ?lowestPension
FROM <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>
FROM <https://data.cssz.cz/resource/dataset/pomocne-ciselniky>
WHERE {
  ?pensionKind skos:exactMatch pension-kind:PK_old_age_total_without_SR .

  [] cssz-dimension:pohlavi sdmx-code:sex-T ;
    cssz-dimension:druh-duchodu ?pensionKind ;
    cssz-dimension:refPeriod ?refPeriod ;
    cssz-dimension:refArea ?refArea1 ;
    cssz-measure:prumerna-vyse-duchodu-v-kc ?lowestPension .

  ?refArea1 a ruian:SpravniObvod .

  FILTER NOT EXISTS {
    [] cssz-dimension:pohlavi sdmx-code:sex-T ;
       cssz-dimension:druh-duchodu ?pensionKind ;
       cssz-dimension:refPeriod ?refPeriod ;
       cssz-dimension:refArea ?refArea2 ;
       cssz-measure:prumerna-vyse-duchodu-v-kc ?evenLowerPension .

    ?refArea2 a ruian:SpravniObvod .

    FILTER (!sameTerm(?refArea1, ?refArea2) && ?evenLowerPension < ?lowestPension)
  }

  ?refPeriod skos:notation ?_date .
  BIND (strdt(?_date, xsd:date) AS ?date)
  ?refArea1 skos:prefLabel ?pragueDistrict .
}
ORDER BY ?date
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .

exercise:greatest-increase-in-pensions-over-5-years a sp:Query ;
  rdfs:label "Největší nárůst důchodů za 5 let"@cs ;
  rdfs:comment "Najděte oblasti, druhy důchodů a pohlaví, pro něž došlo mezi lety 2009 (`day:2014-12-31`) a 2014 (`day:2009-12-31`) k největšímu poměrnému nárůstu důchodů. Zvažujte pouze ženské (`sdmx-code:sex-F`) a mužské (`sdmx-code:sex-M`) pohlaví. Míru růstu důchodů spočítejte jako poměr mezi rozdílem konečného a původního důchodů vydělený původní výší důchodu. Ve výsledcích uveďte název oblasti (`skos:prefLabel`), český název druhu důchodu (`skos:prefLabel`), pohlaví a míru růstu důchodů. Výše důchodů se nachází v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>`. Číselníky jsou v pojmenovaném grafu `<https://data.cssz.cz/resource/dataset/pomocne-ciselniky>`."@cs ;
  sp:text """
PREFIX cssz-dimension: <https://data.cssz.cz/ontology/dimension/>
PREFIX cssz-measure:   <https://data.cssz.cz/ontology/measure/>
PREFIX day:            <https://data.cssz.cz/resource/reference.data.gov.uk/id/gregorian-day/>
PREFIX pension-kind:   <https://data.cssz.cz/resource/pension-kind/>
PREFIX sdmx-code:      <http://purl.org/linked-data/sdmx/2009/code#>
PREFIX skos:           <http://www.w3.org/2004/02/skos/core#>

SELECT ?refAreaLabel ?pensionKindLabel ?gender ?increase
FROM <https://data.cssz.cz/resource/dataset/duchodci-v-cr-krajich-okresech>
FROM <https://data.cssz.cz/resource/dataset/pomocne-ciselniky>
WHERE {
  {
    SELECT ?refArea ?gender ?increase ?pensionKind
    WHERE {
      VALUES ?gender {
        sdmx-code:sex-F
        sdmx-code:sex-M
      }
      [] cssz-dimension:refPeriod day:2014-12-31 ;
        cssz-dimension:pohlavi ?gender ;
        cssz-dimension:refArea ?refArea ;
        cssz-dimension:druh-duchodu/skos:exactMatch ?pensionKind ;
        cssz-measure:prumerna-vyse-duchodu-v-kc ?endPension .

      [] cssz-dimension:refPeriod day:2009-12-31 ;
        cssz-dimension:pohlavi ?gender ;
        cssz-dimension:refArea ?refArea ;
        cssz-dimension:druh-duchodu/skos:exactMatch ?pensionKind ;
        cssz-measure:prumerna-vyse-duchodu-v-kc ?startPension .

      FILTER (?endPension > ?startPension)
      BIND ((?endPension - ?startPension)/?startPension AS ?increase)
    }
    ORDER BY DESC(?increase)
    LIMIT 10
  }

  ?refArea skos:prefLabel ?refAreaLabel .
  ?pensionKind skos:prefLabel ?pensionKindLabel .
}
ORDER BY DESC(?increase)
  """ ;
  sparqlab:hasDifficulty sparqlab:normal .
